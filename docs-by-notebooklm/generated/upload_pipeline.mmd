%%{init: {'theme': 'default', 'themeVariables': {'fontSize': '14px'}}}%%
sequenceDiagram
    autonumber
    participant U as User
    participant E as TipTap
    participant S as SlashCmd
    participant A as Backend
    participant D as /uploads/

    Note over U,D: Upload Flow

    U->>E: Type "/"
    E->>S: Show menu
    U->>S: Select image
    S->>S: Validate <10MB

    rect rgb(209, 250, 229)
        S->>A: POST /uploads
        A->>A: Check MIME
        A->>D: Save file
        A-->>S: {url: "/uploads/x.png"}
    end

    rect rgb(219, 234, 254)
        Note over S,E: URL Transform
        S->>E: Insert img node
        E->>E: getImageUrl()
        Note right of E: "/uploads/x.png"<br/>â†’ "localhost:8000/uploads/x.png"
    end

    E-->>U: Display image

    Note over U,D: Persistence

    E->>A: Auto-save
    U->>E: Reload
    E->>A: GET /notes/:id
    A-->>E: Content
    E-->>U: Image displays
